---
import Layout from '../layouts/Layout.astro';
import questionsData from '../data/questions.json';

const title = "Préparation Civique - Examen de Citoyenneté Française";
---

<Layout title={title}>
	<header class="header">
		<div class="container header-content">
			<div class="logo">
				<div class="flag">
					<span class="blue"></span>
					<span class="white"></span>
					<span class="red"></span>
				</div>
				<h1>Préparation Civique</h1>
			</div>
			<p class="subtitle">Tout pour réussir votre entretien de naturalisation française</p>
		</div>
	</header>

	<main class="container">
		<div class="search-container">
			<input type="text" id="search-input" placeholder="Rechercher une question (ex: 14 juillet, Sénat, Laïcité...)" />
		</div>

		<nav class="categories-nav">
			<h2>Sommaire</h2>
			<ul>
				{questionsData.map((category, index) => (
					<li>
						<a href={`#category-${index}`}>{category.category}</a>
					</li>
				))}
			</ul>
		</nav>

		<div class="questions-list">
			{questionsData.map((category, catIndex) => (
				<section id={`category-${catIndex}`} class="category-section">
					<h2 class="category-title">{category.category}</h2>
					<div class="questions-grid">
						{category.questions.map((item, qIndex) => (
							<a href={`question/${item.slug}`} class="question-card">
								<div class="question-text">
									{item.q}
									<span class="icon">→</span>
								</div>
							</a>
						))}
					</div>
				</section>
			))}
		</div>
	</main>

	<footer class="footer">
		<div class="container">
			<p>&copy; 2026 Préparation Civique - Basé sur QUESTION.MD</p>
		</div>
	</footer>
</Layout>

<script>
	const searchInput = document.getElementById('search-input');
	const questionCards = document.querySelectorAll('.question-card');
	const categorySections = document.querySelectorAll('.category-section');
	const categoriesNav = document.querySelector('.categories-nav');

	searchInput?.addEventListener('input', (e) => {
		const searchTerm = (e.target as HTMLInputElement).value.toLowerCase().trim();
		
		if (searchTerm === '') {
			questionCards.forEach(card => (card as HTMLElement).style.display = 'block');
			categorySections.forEach(section => (section as HTMLElement).style.display = 'block');
			(categoriesNav as HTMLElement).style.display = 'block';
			return;
		}

		(categoriesNav as HTMLElement).style.display = 'none';

		categorySections.forEach(section => {
			let sectionHasMatch = false;
			const cards = section.querySelectorAll('.question-card');
			
			cards.forEach(card => {
				const questionText = card.querySelector('.question-text')?.textContent?.toLowerCase() || '';
				
				if (questionText.includes(searchTerm)) {
					(card as HTMLElement).style.display = 'block';
					sectionHasMatch = true;
				} else {
					(card as HTMLElement).style.display = 'none';
				}
			});

			(section as HTMLElement).style.display = sectionHasMatch ? 'block' : 'none';
		});
	});
</script>

<style>
	.search-container {
		margin: -1.5rem 0 2rem;
		position: sticky;
		top: 1rem;
		z-index: 100;
	}
	#search-input {
		width: 100%;
		padding: 1rem 1.5rem;
		font-size: 1.1rem;
		border: 2px solid var(--accent-blue);
		border-radius: 50px;
		box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
		outline: none;
		transition: border-color 0.2s, box-shadow 0.2s;
	}
	#search-input:focus {
		border-color: var(--blue);
		box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.15);
	}

	.header {
		background: var(--blue);
		color: white;
		padding: 3rem 0;
		text-align: center;
		box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
	}
	.header h1 {
		color: white;
		margin: 1rem 0 0.5rem;
		font-size: 2.5rem;
		font-weight: 800;
	}
	.subtitle {
		font-size: 1.25rem;
		opacity: 0.9;
		max-width: 600px;
		margin: 0 auto;
	}
	.logo {
		display: flex;
		flex-direction: column;
		align-items: center;
	}
	.flag {
		display: flex;
		width: 60px;
		height: 40px;
		border-radius: 4px;
		overflow: hidden;
		border: 2px solid rgba(255, 255, 255, 0.2);
	}
	.flag span {
		flex: 1;
		height: 100%;
	}
	.flag .blue { background: #002395; }
	.flag .white { background: #ffffff; }
	.flag .red { background: #ed2939; }

	.categories-nav {
		background: var(--card-bg);
		padding: 1.5rem;
		border-radius: 12px;
		margin: 2rem 0;
		box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
		border: 1px solid var(--border-color);
	}
	.categories-nav h2 {
		font-size: 1.25rem;
		margin-bottom: 1rem;
		border-bottom: 2px solid var(--light-gray);
		padding-bottom: 0.5rem;
	}
	.categories-nav ul {
		list-style: none;
		padding: 0;
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
		gap: 1rem;
	}
	.categories-nav a {
		text-decoration: none;
		color: var(--accent-blue);
		font-weight: 500;
		transition: color 0.2s;
	}
	.categories-nav a:hover {
		color: var(--blue);
		text-decoration: underline;
	}

	.category-section {
		margin-bottom: 4rem;
	}
	.category-title {
		font-size: 1.75rem;
		margin-bottom: 1.5rem;
		padding-left: 1rem;
		border-left: 6px solid var(--red);
	}

	.questions-grid {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.question-card {
		background: var(--card-bg);
		border: 1px solid var(--border-color);
		border-radius: 8px;
		overflow: hidden;
		transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
		text-decoration: none;
		color: inherit;
		display: block;
	}
	.question-card:hover {
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
		border-color: var(--accent-blue);
	}

	.question-text {
		padding: 1.25rem;
		font-weight: 600;
		display: flex;
		justify-content: space-between;
		align-items: center;
		color: var(--text-color);
	}
	.icon {
		font-size: 1.2rem;
		color: var(--accent-blue);
		transition: transform 0.3s;
	}
	.question-card:hover .icon {
		transform: translateX(4px);
	}

	.footer {
		text-align: center;
		padding: 3rem 0;
		margin-top: 4rem;
		border-top: 1px solid var(--border-color);
		color: #718096;
		font-size: 0.875rem;
	}

	@media (max-width: 600px) {
		.header h1 {
			font-size: 1.75rem;
		}
		.category-title {
			font-size: 1.5rem;
		}
	}
</style>
